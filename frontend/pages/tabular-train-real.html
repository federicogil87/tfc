<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      Entrenar Modelo Tabular con Datos Reales - Sistema de Detección de Cáncer
    </title>
    <link rel="stylesheet" href="../css/style.css" />
    <link rel="stylesheet" href="../css/dashboard.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  </head>
  <body>
    <div class="dashboard-container">
      <!-- Barra lateral -->
      <aside class="sidebar">
        <div class="sidebar-header">
          <h2><i class="fas fa-heartbeat"></i> SDC</h2>
          <button class="sidebar-toggle">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <div class="user-info">
          <div class="user-avatar">
            <span id="user-initial"></span>
          </div>
          <div class="user-details">
            <h4 class="user-name" id="user-info">Usuario</h4>
            <p class="user-role" id="user-role">Rol</p>
          </div>
        </div>

        <nav class="sidebar-nav">
          <ul>
            <li class="nav-item">
              <a href="home.html" class="nav-link">
                <i class="fas fa-home"></i> Inicio
              </a>
            </li>
            <li class="nav-item">
              <a href="dashboard.html" class="nav-link">
                <i class="fas fa-chart-line"></i> Dashboard
              </a>
            </li>
            <li class="nav-item" data-role="Administrador">
              <a href="admin.html" class="nav-link">
                <i class="fas fa-users-cog"></i> Administración
              </a>
            </li>
            <li class="nav-item" data-role="Usuario">
              <a href="cnn-train-real.html" class="nav-link">
                <i class="fas fa-brain"></i> Entrenar CNN
              </a>
            </li>
            <li class="nav-item" data-role="Usuario">
              <a href="cnn-predict-real.html" class="nav-link">
                <i class="fas fa-image"></i> Predecir con CNN
              </a>
            </li>
            <li class="nav-item" data-role="Usuario">
              <a href="tabular-train-real.html" class="nav-link active">
                <i class="fas fa-table"></i> Entrenar Tabular
              </a>
            </li>
            <li class="nav-item" data-role="Usuario">
              <a href="tabular-predict-real.html" class="nav-link">
                <i class="fas fa-chart-bar"></i> Predecir con Tabular
              </a>
            </li>
            <li class="nav-item" data-role="Testing">
              <a href="cnn-train.html" class="nav-link">
                <i class="fas fa-brain"></i> Entrenar con Datos de Prueba
              </a>
            </li>
            <li class="nav-item" data-role="Testing">
              <a href="cnn-predict.html" class="nav-link">
                <i class="fas fa-image"></i> Predecir con Datos de Prueba
              </a>
            </li>
          </ul>
        </nav>

        <div class="sidebar-footer">
          <button id="logout-button" class="logout-button">
            <i class="fas fa-sign-out-alt"></i> Cerrar sesión
          </button>
        </div>
      </aside>

      <!-- Contenido principal -->
      <main class="main-content">
        <header class="content-header">
          <button class="sidebar-toggle">
            <i class="fas fa-bars"></i>
          </button>
          <h1 class="page-title">Entrenar Modelo Tabular con Datos Reales</h1>
        </header>

        <div class="content-container">
          <!-- Contenedor de alertas -->
          <div id="alerts-container"></div>

          <!-- Formulario de subida de archivo -->
          <div class="dashboard-card">
            <div class="card-header">
              <h2 class="dashboard-card-title">
                <i class="fas fa-file-upload"></i> Cargar Datos
              </h2>
            </div>

            <div class="card-body">
              <p>
                Suba un archivo CSV o Excel que contenga los datos para entrenar
                su modelo tabular.
              </p>

              <form id="file-upload-form" enctype="multipart/form-data">
                <div class="form-group">
                  <label for="tabular-file">Archivo de datos</label>
                  <input
                    type="file"
                    id="tabular-file"
                    name="file"
                    accept=".csv,.xlsx,.xls"
                    required
                  />
                  <small class="text-muted">
                    Formatos aceptados: CSV (.csv), Excel (.xlsx, .xls)
                  </small>
                </div>

                <div class="form-group">
                  <button type="submit" class="btn btn-primary">
                    <i class="fas fa-upload"></i> Cargar Datos
                    <span class="btn-loader"></span>
                  </button>
                </div>
              </form>
            </div>
          </div>

          <!-- Vista previa de datos y selección de columnas -->
          <div
            class="dashboard-card mt-4"
            id="data-preview-card"
            style="display: none"
          >
            <div class="card-header">
              <h2 class="dashboard-card-title">
                <i class="fas fa-table"></i> Vista Previa de Datos
              </h2>
            </div>

            <div class="card-body">
              <div id="data-info">
                <!-- Información del archivo -->
              </div>

              <div class="data-table-container mt-3">
                <div id="data-preview">
                  <!-- Vista previa de datos -->
                </div>
              </div>

              <div class="column-selection mt-4">
                <h3>Selección de Columnas</h3>
                <div class="form-group">
                  <label for="target-column">Columna Objetivo</label>
                  <select id="target-column" name="target_column" required>
                    <option value="">
                      -- Seleccione la columna objetivo --
                    </option>
                  </select>
                  <small class="text-muted">
                    Esta es la columna que su modelo intentará predecir.
                  </small>
                </div>

                <div class="form-group">
                  <label>Columnas de Características</label>
                  <div id="feature-columns" class="feature-columns-container">
                    <!-- Checkboxes para las columnas de características -->
                  </div>
                  <small class="text-muted">
                    Seleccione las columnas que desea utilizar como
                    características para el entrenamiento.
                  </small>
                </div>

                <div class="form-group">
                  <label>Columnas Categóricas</label>
                  <div
                    id="categorical-columns"
                    class="feature-columns-container"
                  >
                    <!-- Checkboxes para las columnas categóricas -->
                  </div>
                  <small class="text-muted">
                    Seleccione las columnas que son categóricas (no numéricas).
                  </small>
                </div>
              </div>
            </div>
          </div>

          <!-- Configuración del modelo -->
          <div
            class="dashboard-card mt-4"
            id="model-config-card"
            style="display: none"
          >
            <div class="card-header">
              <h2 class="dashboard-card-title">
                <i class="fas fa-cogs"></i> Configuración del Modelo
              </h2>
            </div>

            <div class="card-body">
              <form id="tabular-train-form">
                <div class="form-row">
                  <div class="form-col">
                    <div class="form-group">
                      <label for="model-name">Nombre del modelo</label>
                      <input
                        type="text"
                        id="model-name"
                        name="model_name"
                        placeholder="mi_modelo_tabular"
                        required
                      />
                    </div>
                  </div>
                  <div class="form-col">
                    <div class="form-group">
                      <label for="algorithm">Algoritmo</label>
                      <select id="algorithm" name="algorithm" required>
                        <option value="svm">
                          Support Vector Machine (SVM)
                        </option>
                        <option value="knn">k-Nearest Neighbors (k-NN)</option>
                        <option value="random_forest">Random Forest</option>
                        <option value="linear_regression">
                          Regresión Lineal
                        </option>
                      </select>
                    </div>
                  </div>
                  <div class="form-col">
                    <div class="form-group">
                      <label for="problem-type">Tipo de problema</label>
                      <select id="problem-type" name="problem_type" required>
                        <option value="classification">Clasificación</option>
                        <option value="regression">Regresión</option>
                      </select>
                    </div>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-col">
                    <div class="form-group">
                      <label for="test-size">Proporción de test</label>
                      <input
                        type="number"
                        id="test-size"
                        name="test_size"
                        min="0.1"
                        max="0.5"
                        step="0.05"
                        value="0.2"
                        required
                      />
                      <small class="text-muted">
                        Proporción de datos usados para validación (0.1 - 0.5)
                      </small>
                    </div>
                  </div>
                </div>

                <!-- Parámetros específicos para cada algoritmo -->
                <div class="hyperparameters-section">
                  <h3>Hiperparámetros</h3>

                  <!-- SVM -->
                  <div id="svm-params" class="algorithm-info active">
                    <div class="form-row">
                      <div class="form-col">
                        <div class="form-group">
                          <label for="svm-kernel">Kernel</label>
                          <select id="svm-kernel" name="model_params.kernel">
                            <option value="rbf">RBF</option>
                            <option value="linear">Linear</option>
                            <option value="poly">Polynomial</option>
                            <option value="sigmoid">Sigmoid</option>
                          </select>
                        </div>
                      </div>
                      <div class="form-col">
                        <div class="form-group">
                          <label for="svm-c">C (Regularización)</label>
                          <input
                            type="number"
                            id="svm-c"
                            name="model_params.C"
                            min="0.1"
                            step="0.1"
                            value="1.0"
                          />
                        </div>
                      </div>
                      <div class="form-col">
                        <div class="form-group">
                          <label for="svm-gamma">Gamma</label>
                          <input
                            type="text"
                            id="svm-gamma"
                            name="model_params.gamma"
                            value="scale"
                          />
                          <small class="text-muted">
                            Valor o 'scale' o 'auto'
                          </small>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- k-NN -->
                  <div id="knn-params" class="algorithm-info">
                    <div class="form-row">
                      <div class="form-col">
                        <div class="form-group">
                          <label for="knn-n-neighbors">Número de vecinos</label>
                          <input
                            type="number"
                            id="knn-n-neighbors"
                            name="model_params.n_neighbors"
                            min="1"
                            value="5"
                          />
                        </div>
                      </div>
                      <div class="form-col">
                        <div class="form-group">
                          <label for="knn-weights">Pesos</label>
                          <select id="knn-weights" name="model_params.weights">
                            <option value="uniform">Uniforme</option>
                            <option value="distance">Distancia</option>
                          </select>
                        </div>
                      </div>
                      <div class="form-col">
                        <div class="form-group">
                          <label for="knn-algorithm">Algoritmo</label>
                          <select
                            id="knn-algorithm"
                            name="model_params.algorithm"
                          >
                            <option value="auto">Auto</option>
                            <option value="ball_tree">Ball Tree</option>
                            <option value="kd_tree">KD Tree</option>
                            <option value="brute">Brute Force</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Random Forest -->
                  <div id="random-forest-params" class="algorithm-info">
                    <div class="form-row">
                      <div class="form-col">
                        <div class="form-group">
                          <label for="rf-n-estimators">Número de árboles</label>
                          <input
                            type="number"
                            id="rf-n-estimators"
                            name="model_params.n_estimators"
                            min="10"
                            value="100"
                          />
                        </div>
                      </div>
                      <div class="form-col">
                        <div class="form-group">
                          <label for="rf-max-depth">Profundidad máxima</label>
                          <input
                            type="number"
                            id="rf-max-depth"
                            name="model_params.max_depth"
                            min="1"
                            value="10"
                          />
                          <small class="text-muted">
                            Dejar en blanco para ilimitado
                          </small>
                        </div>
                      </div>
                      <div class="form-col">
                        <div class="form-group">
                          <label for="rf-min-samples-split">
                            Muestras mínimas para dividir
                          </label>
                          <input
                            type="number"
                            id="rf-min-samples-split"
                            name="model_params.min_samples_split"
                            min="2"
                            value="2"
                          />
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Regresión Lineal -->
                  <div id="linear-regression-params" class="algorithm-info">
                    <div class="form-row">
                      <div class="form-col">
                        <div class="form-group">
                          <label for="lr-model-type">Tipo</label>
                          <select
                            id="lr-model-type"
                            name="model_params.model_type"
                          >
                            <option value="simple">Simple</option>
                            <option value="ridge">Ridge</option>
                            <option value="lasso">Lasso</option>
                          </select>
                        </div>
                      </div>
                      <div class="form-col">
                        <div class="form-group">
                          <label for="lr-alpha">Alpha (Regularización)</label>
                          <input
                            type="number"
                            id="lr-alpha"
                            name="model_params.alpha"
                            min="0.01"
                            step="0.01"
                            value="1.0"
                          />
                          <small class="text-muted">
                            Solo para Ridge y Lasso
                          </small>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Campos ocultos para la información de columnas -->
                <input
                  type="hidden"
                  id="target-column-hidden"
                  name="target_column"
                />
                <input
                  type="hidden"
                  id="feature-columns-hidden"
                  name="features"
                />
                <input
                  type="hidden"
                  id="categorical-columns-hidden"
                  name="categorical_columns"
                />

                <div class="form-group mt-4">
                  <button type="submit" class="btn btn-primary">
                    <i class="fas fa-play"></i> Entrenar Modelo
                    <span class="btn-loader"></span>
                  </button>
                </div>
              </form>
            </div>
          </div>

          <!-- Resultados del entrenamiento -->
          <div
            id="training-results"
            class="dashboard-card mt-4"
            style="display: none"
          >
            <div class="card-header">
              <h2 class="dashboard-card-title">
                <i class="fas fa-chart-line"></i> Resultados del Entrenamiento
              </h2>
            </div>

            <div class="card-body">
              <div id="results-content"></div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <script src="../js/api.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/dashboard.js"></script>
    <script src="../js/tabular-train-real.js"></script>
    <script>
      // Proteger esta página, solo para usuarios con rol Usuario
      handleProtectedPage(["Usuario"]);
    </script>
  </body>
</html>
